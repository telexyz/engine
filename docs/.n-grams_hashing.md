https://stackoverflow.com/questions/62664761/probability-of-hash-collision

Let's imagine we have a truly random hash function that hashes from strings to n-bit numbers. This means that there are 2^n possible hash codes, and each string's hash code is chosen uniformly at random from all of those possibilities. 

The birthday paradox specifically says that once you've seen roughly √(2k) items, there's a 50% chance of a collision, where k is the number of distinct possible outputs. In the case where the hash function hashes to an n-bit output, this means that you'll need roughly 2^n/2 hashes before you get a collision. 

If we pick hashes that output 64 bits; we'd need `2^32 ≈ 4.3*10^9` items hashed before there's a "reasonable" chance of a collision.

Với k uniq items đầu vào, bảng băm output ra n-bits, p là xác suất va chạm: 

k ≈ 2^{(n+1)/2} √p

Giả sử cần chứa 30m n-grams `k=30*10^6`, bảng băm đầu ra 64-bits `n=64` 
=> 30m = 2^32.5 x √p => √p = 0.0049390838 => p = 0.00002439454
Khả năng va chạm khi chứa 30m ids trong băm 64-bits là 25/m hay 1/40k.

Giả sử cần chứa 12m n-grams `k=12*10^6`, bảng băm đầu ra 64-bits `n=64` 
=> 12m = 2^32.5 x √p => √p = 0.00197563352 => p = 0.00000390312
Khả năng va chạm khi chứa 30m ids trong băm 64-bits là 4/m hay 1/250k.

- - -

Với 1,2,3,4-grams giữ nguyên giá trị đầu vào là `u64`
Với 5,6,7,8-grams thì hash về `u64` và có thể có va chạm nghĩa là bị mất đi